# TMUX.CONF
# =========

# =======================
# Aesthetic configuration
# =======================
  # ----------
  # Status bar
  # ----------
    set -g status-position top
  # ------------
  # Window title
  # ------------
    set -g automatic-rename on
    set -g set-titles on
    set -g set-titles-string "#{session_name}:#{window_index}:#{window_name}"
  # ------------------
  # True-color support
  # ------------------
    set -g default-terminal "tmux-256color"
    set -ga terminal-overrides ",xterm-256color:RGB"
  # ----------
  # Undercurls
  # ----------
    set -ga terminal-overrides ',*:Smulx=\E[4::%p1%dm'
    set -ga terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# ======================
# Terminal configuration
# ======================
  # -----------------------
  # Clipboard configuration
  # -----------------------
    set -g set-clipboard on
  # -------------------
  # Mouse configuration
  # -------------------
    set -g mouse on
  # --------------------
  # Timing configuration
  # --------------------
    set -g repeat-time 400
  # ----------
  # xterm keys
  # ----------
    set -g xterm-keys on
  # -------------
  # CSI u support
  # -------------
    set -g extended-keys on

# =========================
# Multiplexor configuration
# =========================
  # --------------------
  # Window configuration
  # --------------------
    # Start window numbering at 1
    set -g base-index 1
    # Start pane numbering at 1
    set -g pane-base-index 1
    # Renumber windows when a window is closed
    set -g renumber-windows on
  # ----------------------
  # Activity configuration
  # ----------------------
    set -g monitor-activity on
    set -g visual-activity off
    set -g bell-action none
    set -g visual-bell off
    set -g visual-silence off

# ============
# Key Bindings
# ============
  # ------
  # Prefix
  # ------
    set -g prefix C-b
  # --------
  # VIM mode
  # --------
    set -g mode-keys vi
    set -g status-keys vi
  # ----------
  # Navigation
  # ----------
    # Select window
    bind -n M-1 select-window -t 1
    bind -n M-2 select-window -t 2
    bind -n M-3 select-window -t 3
    bind -n M-4 select-window -t 4
    bind -n M-5 select-window -t 5
    bind -n M-6 select-window -t 6
    bind -n M-7 select-window -t 7
    bind -n M-8 select-window -t 8
    bind -n M-9 select-window -t 9
    bind -n M-0 select-window -t 0
  # ------
  # Splits
  # ------
    # Horizontal split
    bind \" split-window -h -c "#{pane_current_path}"
    bind = split-window -h -c "#{pane_current_path}"
    # Vertical split
    bind - split-window -v -c "#{pane_current_path}"
    bind % split-window -v -c "#{pane_current_path}"
  # -------
  # Windows
  # -------
    bind c new-window -c "#{pane_current_path}"
    bind x kill-pane
  # -----------------------------------------------
  # Intregration with mrjones2014/smart-splits.nvim
  # -----------------------------------------------
    is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
        | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

    bind -n C-w if-shell "$is_vim" { send-keys C-w } { switch-client -T VIM }
    bind -T VIM C-w send-keys C-w

    bind -T VIM h { select-pane -L }
    bind -T VIM j { select-pane -D }
    bind -T VIM k { select-pane -U }
    bind -T VIM l { select-pane -R }

    bind-key -n M-h if-shell "$is_vim" { send-keys M-h } { resize-pane -L 3 }
    bind-key -n M-j if-shell "$is_vim" { send-keys M-j } { resize-pane -D 3 }
    bind-key -n M-k if-shell "$is_vim" { send-keys M-k } { resize-pane -U 3 }
    bind-key -n M-l if-shell "$is_vim" { send-keys M-l } { resize-pane -R 3 }
  # -------------
  # Miscellaneous
  # -------------
    # Reload configuration
    bind r source ~/.config/tmux/tmux.conf \; display-message "Configuration reloaded..."

# =======
# Plugins
# =======
  set -g @plugin 'tmux-plugins/tpm'
  set -g @plugin 'tmux-plugins/tmux-sensible'
  set -g @plugin 'nhdaly/tmux-better-mouse-mode'
  set -g @plugin 'tmux-plugins/tmux-yank'
  set -g @plugin 'tmux-plugins/tmux-resurrect'
  set -g @plugin 'tmux-plugins/tmux-continuum'
  set -g @plugin 'catppuccin/tmux'
  set -g @plugin 'victorkristof/tmux-auto-dark-mode'

# ====================
# Plugin configuration
# ====================
  # --------------
  # tmux-continuum
  # --------------
    set -g @continuum-restore 'on'
  # -------------------
  # tmux-auto-dark-mode
  # -------------------
    set -g @adm-dark-status '~/.config/tmux/dark-mode.conf'
    set -g @adm-light-status '~/.config/tmux/light-mode.conf'

# ============
# Finalization
# ============
  # -------------------
  # $PATH configuration
  # -------------------
    # Add MacOS ARM Homebrew binaries to $PATH
    setenv -g PATH "/opt/homebrew/bin:$PATH"
  # ------------------
  # TPM Initialization
  # ------------------
    # Execute Tmux Package Manager
    run '~/.config/tmux/plugins/tpm/tpm'
